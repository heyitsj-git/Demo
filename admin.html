<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard | POP N' PLAN</title>
  <link rel="icon" href="logo.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Saira:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />
  <style>
    :root {
      /* iOS-inspired color palette */
      --ios-blue: #007AFF;
      --ios-green: #34C759;
      --ios-orange: #FF9500;
      --ios-red: #FF3B30;
      --ios-purple: #AF52DE;
      --ios-pink: #FF2D92;
      --ios-teal: #5AC8FA;
      --ios-indigo: #5856D6;
      
      /* Neutral colors */
      --ios-gray-1: #F2F2F7;
      --ios-gray-2: #E5E5EA;
      --ios-gray-3: #D1D1D6;
      --ios-gray-4: #C7C7CC;
      --ios-gray-5: #AEAEB2;
      --ios-gray-6: #8E8E93;
      --ios-gray-7: #636366;
      --ios-gray-8: #48484A;
      --ios-gray-9: #3A3A3C;
      --ios-gray-10: #2C2C2E;
      --ios-gray-11: #1C1C1E;
      
      /* Background colors */
      --bg-primary: #FFFFFF;
      --bg-secondary: #F2F2F7;
      --bg-tertiary: #FFFFFF;
      --bg-grouped: #F2F2F7;
      
      /* Text colors */
      --text-primary: #000000;
      --text-secondary: #3C3C43;
      --text-tertiary: #3C3C43;
      --text-quaternary: #3C3C43;
      
      /* Shadow system */
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
      --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.15);
      
      /* Border radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      
      /* Spacing */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;
      
      /* Typography */
      --font-size-xs: 12px;
      --font-size-sm: 14px;
      --font-size-md: 16px;
      --font-size-lg: 18px;
      --font-size-xl: 20px;
      --font-size-2xl: 24px;
      --font-size-3xl: 32px;
      
      --font-weight-regular: 400;
      --font-weight-medium: 500;
      --font-weight-semibold: 600;
      --font-weight-bold: 700;
    }

    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }
    
    body { 
      background: var(--bg-grouped);
      color: var(--text-primary);
      font-size: var(--font-size-md);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Layout */
    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--bg-primary);
      border-right: 1px solid var(--ios-gray-2);
      height: 100vh;
      padding: var(--space-lg);
      display: flex;
      flex-direction: column;
      position: fixed;
      box-shadow: var(--shadow-md);
      z-index: 1000;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    
    .sidebar::-webkit-scrollbar {
      display: none;
    }
    .logo-container {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      margin-bottom: var(--space-2xl);
      padding: var(--space-lg) 0;
      border-bottom: 1px solid var(--ios-gray-2);
    }
    
    .logo-container img {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      transition: transform 0.2s ease;
    }
    
    .logo-container:hover img {
      transform: scale(1.05);
    }
    
    .logo-container h2 {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--text-primary);
      letter-spacing: -0.5px;
    }
    
    .menu {
      flex: 1;
    }
    
    .menu h4 {
      margin: var(--space-2xl) 0 var(--space-md);
      font-size: var(--font-size-xs);
      color: var(--ios-gray-6);
      font-weight: var(--font-weight-semibold);
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 0 var(--space-sm);
    }
    
    .menu ul {
      list-style: none;
    }
    
    .menu li {
      margin-bottom: var(--space-xs);
    }
    
    .menu a {
      text-decoration: none;
      color: var(--text-secondary);
      padding: var(--space-md) var(--space-lg);
      display: flex;
      align-items: center;
      gap: var(--space-md);
      border-radius: var(--radius-md);
      font-weight: var(--font-weight-medium);
      font-size: var(--font-size-md);
      transition: all 0.2s ease;
      position: relative;
    }
    
    .menu a:hover {
      background: var(--ios-gray-1);
      color: var(--ios-blue);
    }
    
    .menu a.active {
      background: var(--ios-blue);
      color: var(--bg-primary);
    }
    
    .menu a .material-icons {
      font-size: 20px;
      transition: all 0.2s ease;
    }
    
    .menu a:hover .material-icons,
    .menu a.active .material-icons {
      transform: scale(1.1);
    }

    /* Main Content */
    .main {
      margin-left: 280px;
      flex: 1;
      padding: var(--space-xl);
      max-height: 100vh;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      background: var(--bg-grouped);
    }
    
    .main::-webkit-scrollbar {
      display: none;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-xl);
      background: var(--bg-primary);
      padding: var(--space-lg) var(--space-xl);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--ios-gray-2);
      position: sticky;
      top: var(--space-lg);
      z-index: 999;
    }
    
    .header .search-bar {
      position: relative;
      width: 320px;
    }
    
    .header .search-bar input {
      width: 100%;
      padding: var(--space-md) var(--space-lg) var(--space-md) 48px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--ios-gray-3);
      background: var(--bg-secondary);
      font-size: var(--font-size-md);
      color: var(--text-primary);
      transition: all 0.2s ease;
      font-weight: var(--font-weight-regular);
    }
    
    .header .search-bar input::placeholder {
      color: var(--ios-gray-6);
    }
    
    .header .search-bar input:focus {
      border-color: var(--ios-blue);
      background: var(--bg-primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }
    
    .header .search-bar .material-icons {
      position: absolute;
      left: var(--space-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--ios-gray-6);
      font-size: 20px;
      transition: all 0.2s ease;
    }

    /* Admin Profile in Header */
    .admin-profile {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-sm) var(--space-md);
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      border: 1px solid var(--ios-gray-2);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .admin-profile:hover {
      background: var(--ios-gray-1);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }
    
    .admin-profile img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--ios-gray-3);
      transition: all 0.2s ease;
    }
    
    .admin-profile span {
      font-size: var(--font-size-md);
      font-weight: var(--font-weight-semibold);
      color: var(--text-primary);
    }

    /* Page Titles */
    .page h1 {
      font-size: var(--font-size-3xl);
      color: var(--text-primary);
      margin-bottom: var(--space-xl);
      font-weight: var(--font-weight-bold);
      text-align: center;
      padding: var(--space-lg) 0;
      border-bottom: 1px solid var(--ios-gray-2);
    }

    /* Cards & Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: var(--space-lg);
      margin-bottom: var(--space-xl);
    }
    
    .stat-card {
      background: var(--bg-primary);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--ios-gray-2);
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }
    
    .stat-card .icon {
      font-size: 32px;
      color: var(--bg-primary);
      margin-bottom: var(--space-md);
      background: var(--ios-blue);
      border-radius: var(--radius-md);
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-sm);
      transition: all 0.2s ease;
    }
    
    .stat-card:hover .icon {
      transform: scale(1.05);
    }
    
    .stat-card h3 {
      font-size: var(--font-size-sm);
      color: var(--ios-gray-6);
      margin-bottom: var(--space-sm);
      font-weight: var(--font-weight-semibold);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-card p {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      color: var(--text-primary);
    }
    
    .stat-card.new-members p {
      color: var(--ios-green);
    }
    
    .stat-card.total-events p {
      color: var(--ios-orange);
    }
    
    .stat-card.impressions p {
      color: var(--ios-purple);
    }

    .page { 
      display: none; 
    }
    
    .page.active { 
      display: block; 
    }
    
    .card {
      background: var(--bg-primary);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--ios-gray-2);
      margin-bottom: var(--space-xl);
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .card:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    
    .card h2 {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--text-primary);
      margin-bottom: var(--space-lg);
    }

    /* Form Elements */
    .card form input[type="text"],
    .card form input[type="email"],
    .card form input[type="date"],
    .card form input[type="time"],
    .card form textarea,
    .card form select {
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      margin-bottom: var(--space-lg);
      border: 1px solid var(--ios-gray-3);
      border-radius: var(--radius-md);
      font-size: var(--font-size-md);
      color: var(--text-primary);
      background: var(--bg-primary);
      transition: all 0.2s ease;
      font-weight: var(--font-weight-regular);
    }
    
    .card form input:focus,
    .card form textarea:focus,
    .card form select:focus {
      border-color: var(--ios-blue);
      background: var(--bg-primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }
    
    .card form textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .btn-primary {
      background: var(--ios-blue);
      color: var(--bg-primary);
      padding: var(--space-md) var(--space-xl);
      border: none;
      border-radius: var(--radius-md);
      font-size: var(--font-size-md);
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: var(--space-sm);
      box-shadow: var(--shadow-sm);
    }
    
    .btn-primary:hover {
      background: #0056CC;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    
    .btn-primary .material-icons {
      font-size: 18px;
    }

    /* Event Cards List */
    .event-list-grid {
        display:grid;
        grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));
        gap:20px;
    }
    .event-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
      border-radius:16px;
      padding:20px;
      box-shadow:0 8px 30px rgba(102, 126, 234, 0.08);
      border:1px solid rgba(102, 126, 234, 0.1);
      display:flex;
      flex-direction:column;
      transition:all 0.4s ease;
      position: relative;
      overflow:hidden;
    }
    .event-card::before {
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:3px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }
    .event-card:hover {
        transform:translateY(-5px) scale(1.02);
        box-shadow:0 15px 50px rgba(102, 126, 234, 0.15);
        border-color:rgba(102, 126, 234, 0.3);
    }
    .event-card img {
      width:100%; height:200px; object-fit:cover; border-radius:12px; margin-bottom:15px;
      box-shadow:0 4px 15px rgba(0,0,0,0.1);
      transition:transform 0.3s ease;
    }
    .event-card:hover img {
      transform:scale(1.05);
    }
    .event-card h4 {
        margin:0 0 12px; font-size:20px; color:#333; font-weight:800;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip:text;
        -webkit-text-fill-color:transparent;
        text-shadow:0 2px 4px rgba(0,0,0,0.1);
    }
    .event-card p { font-size:14px; color:#666; margin-bottom:5px; display:flex; align-items:center; gap:5px;}
    .event-card small { font-size:13px; color:#888; flex-grow:1; }
    .event-card .event-actions {
        margin-top: 15px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    .event-card .event-actions button {
        background: linear-gradient(135deg, #f5365c, #e21c3d);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(245, 54, 92, 0.3);
    }
    .event-card .event-actions button.edit-event {
        background: linear-gradient(135deg, #2dce89, #24a46d);
        box-shadow: 0 4px 15px rgba(45, 206, 137, 0.3);
    }
    .event-card .event-actions button.edit-event:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(45, 206, 137, 0.4);
    }
    .event-card .event-actions button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(245, 54, 92, 0.4);
    }
    .event-card .event-actions button .material-icons {
        font-size: 18px;
    }

    /* Professional Loading Animation */
    .loading {
      text-align:center; 
      padding:60px; 
      color:#667eea;
      font-size:18px;
      font-weight:600;
    }
    .loading::after {
      content:'';
      display:inline-block;
      width:40px;
      height:40px;
      border:4px solid #f0f2f5;
      border-top:4px solid #667eea;
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin-left:15px;
      vertical-align:middle;
    }
    @keyframes spin {
      0% { transform:rotate(0deg); }
      100% { transform:rotate(360deg); }
    }

    /* Professional Table Styling */
    table {
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 25px;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.08);
    }
    table th, table td {
      padding: 18px 20px; 
      text-align: left; 
      border-bottom: 1px solid #f0f2f5;
      font-size: 15px;
    }
    table th { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 13px;
    }
    table tr:hover { 
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      transform: scale(1.01);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
    }
    table tr {
      transition: all 0.3s ease;
    }

    /* Professional Status Badges */
    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .status-pending {
      background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
      color: white;
    }
    .status-approved {
      background: linear-gradient(135deg, #2dce89 0%, #24a46d 100%);
      color: white;
    }
    .status-rejected {
      background: linear-gradient(135deg, #f5365c 0%, #e21c3d 100%);
      color: white;
    }

    /* Professional Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    .empty-state .material-icons {
      font-size: 64px;
      color: #ddd;
      margin-bottom: 20px;
    }
    .empty-state h3 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 10px;
      color: #666;
    }
    .empty-state p {
      font-size: 16px;
      color: #999;
    }


    /* Member List */
    .member-list {
        list-style:none;
        padding:0;
    }
    .member-list li {
        display:flex;
        align-items:center;
        gap:15px;
        padding:12px 0;
        border-bottom:1px solid #eee;
        transition: background 0.2s;
    }
    .member-list li:hover {
        background: #fcfcfc;
    }
    .member-list li:last-child {
        border-bottom:none;
    }
    .member-list li img {
        width:40px;
        height:40px;
        border-radius:50%;
        object-fit:cover;
        border:2px solid #2dce89;
    }
    .member-list li span {
        font-weight:600;
        color:#444;
        font-size:16px;
    }
    .member-list li small {
        margin-left:auto;
        color:#777;
        font-size:13px;
    }
    .member-list .member-actions {
        display: flex;
        gap: 8px;
        margin-left: auto; /* Push actions to the right */
    }
    .member-list .member-actions button {
        background: #2dce89; /* Example edit button color */
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
        transition: background 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    .member-list .member-actions button .material-icons {
        font-size: 16px;
    }
    .member-list .member-actions button.delete {
        background: #dc3545; /* Red for delete */
        color: white;
    }
    .member-list .member-actions button:hover {
        opacity: 0.9;
    }

    /* FullCalendar adjustments */
    #calendar {
        max-width: 900px;
        margin: 0 auto;
        padding-top: 20px;
    }
    .fc-event {
        cursor: pointer;
    }
    .fc-event-main-frame { /* Make event text readable */
        font-size: 14px;
    }


    /* Messages Page - iOS Style */
    .whatsapp-container {
        display: flex;
        height: 600px;
        background: var(--bg-primary);
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--ios-gray-2);
    }
    
    /* Sidebar for contacts */
    .contacts-sidebar {
        width: 320px;
        background: var(--bg-secondary);
        border-right: 1px solid var(--ios-gray-2);
        display: flex;
        flex-direction: column;
    }
    
    .contacts-header {
        padding: var(--space-lg);
        background: var(--bg-primary);
        border-bottom: 1px solid var(--ios-gray-2);
        display: flex;
        align-items: center;
        gap: var(--space-md);
    }
    
    .contacts-header h3 {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-bold);
        color: var(--text-primary);
        margin: 0;
    }
    
    .contacts-header button {
        background: var(--ios-blue);
        color: var(--bg-primary);
        border: none;
        border-radius: var(--radius-md);
        padding: var(--space-sm);
        cursor: pointer;
        transition: all 0.2s ease;
        margin-left: auto;
    }
    
    .contacts-header button:hover {
        background: #0056CC;
        transform: scale(1.05);
    }
    
    .contacts-search {
        padding: var(--space-md) var(--space-lg);
        border-bottom: 1px solid var(--ios-gray-2);
    }
    
    .contacts-search input {
        width: 100%;
        padding: var(--space-sm) var(--space-md);
        border: 1px solid var(--ios-gray-3);
        border-radius: var(--radius-md);
        background: var(--bg-primary);
        font-size: var(--font-size-sm);
        color: var(--text-primary);
        transition: all 0.2s ease;
    }
    
    .contacts-search input:focus {
        border-color: var(--ios-blue);
        outline: none;
        box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }
    
    .contacts-list {
        flex: 1;
        overflow-y: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }
    
    .contacts-list::-webkit-scrollbar {
        display: none;
    }
    
    .contact-item {
        display: flex;
        align-items: center;
        padding: var(--space-md) var(--space-lg);
        cursor: pointer;
        transition: all 0.2s ease;
        border-bottom: 1px solid var(--ios-gray-1);
    }
    
    .contact-item:hover {
        background: var(--ios-gray-1);
    }
    
    .contact-item.active {
        background: var(--ios-blue);
        color: var(--bg-primary);
    }
    
    .contact-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: var(--ios-blue);
        color: var(--bg-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: var(--font-weight-bold);
        font-size: var(--font-size-lg);
        margin-right: var(--space-md);
        flex-shrink: 0;
    }
    
    .contact-info {
        flex: 1;
        min-width: 0;
    }
    
    .contact-name {
        font-size: var(--font-size-md);
        font-weight: var(--font-weight-semibold);
        color: var(--text-primary);
        margin-bottom: var(--space-xs);
    }
    
    .contact-role {
        font-size: var(--font-size-sm);
        color: var(--ios-gray-6);
    }
    
    .contact-status {
        background: var(--ios-red);
        color: var(--bg-primary);
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--font-size-xs);
        font-weight: var(--font-weight-bold);
        margin-left: var(--space-sm);
    }
    
    /* Chat area */
    .chat-area {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--bg-primary);
    }
    
    .chat-header {
        padding: var(--space-lg);
        background: var(--bg-primary);
        border-bottom: 1px solid var(--ios-gray-2);
        display: flex;
        align-items: center;
        gap: var(--space-md);
    }
    
    .chat-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: var(--ios-gray-3);
        color: var(--text-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: var(--font-weight-bold);
        font-size: var(--font-size-lg);
    }
    
    .chat-info {
        flex: 1;
    }
    
    .chat-name {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-semibold);
        color: var(--text-primary);
        margin-bottom: var(--space-xs);
    }
    
    .chat-status {
        font-size: var(--font-size-sm);
        color: var(--ios-gray-6);
    }
    
    .chat-actions {
        display: flex;
        gap: var(--space-sm);
    }
    
    .chat-actions button {
        background: var(--bg-secondary);
        border: 1px solid var(--ios-gray-3);
        border-radius: var(--radius-md);
        padding: var(--space-sm);
        cursor: pointer;
        transition: all 0.2s ease;
        color: var(--text-primary);
    }
    
    .chat-actions button:hover {
        background: var(--ios-gray-1);
        transform: scale(1.05);
    }
    
    .messages-container {
        flex: 1;
        padding: var(--space-lg);
        overflow-y: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
    }
    
    .messages-container::-webkit-scrollbar {
        display: none;
    }
    
    .message-bubble {
        max-width: 70%;
        padding: var(--space-md) var(--space-lg);
        border-radius: var(--radius-lg);
        font-size: var(--font-size-md);
        line-height: 1.4;
        word-wrap: break-word;
        position: relative;
    }
    
    .message-bubble.sent {
        background: var(--ios-blue);
        color: var(--bg-primary);
        align-self: flex-end;
        border-bottom-right-radius: var(--radius-sm);
    }
    
    .message-bubble.received {
        background: var(--ios-gray-2);
        color: var(--text-primary);
        align-self: flex-start;
        border-bottom-left-radius: var(--radius-sm);
    }
    
    .message-text {
        margin-bottom: var(--space-xs);
    }
    
    .message-time {
        font-size: var(--font-size-xs);
        opacity: 0.7;
        text-align: right;
    }
    
    .message-bubble.received .message-time {
        text-align: left;
    }
    
    .message-input-container {
        padding: var(--space-lg);
        background: var(--bg-primary);
        border-top: 1px solid var(--ios-gray-2);
        display: flex;
        gap: var(--space-md);
        align-items: center;
    }
    
    .message-input {
        flex: 1;
        padding: var(--space-md) var(--space-lg);
        border: 1px solid var(--ios-gray-3);
        border-radius: var(--radius-lg);
        background: var(--bg-secondary);
        font-size: var(--font-size-md);
        color: var(--text-primary);
        transition: all 0.2s ease;
    }
    
    .message-input:focus {
        border-color: var(--ios-blue);
        outline: none;
        box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }
    
    .send-button {
        background: var(--ios-blue);
        color: var(--bg-primary);
        border: none;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-sm);
    }
    
    .send-button:hover {
        background: #0056CC;
        transform: scale(1.05);
        box-shadow: var(--shadow-md);
    }
    
    .send-button:disabled {
        background: var(--ios-gray-4);
        cursor: not-allowed;
        transform: none;
    }
    
    .chat-actions {
        display: flex;
        gap: 10px;
    }
    
    .chat-actions button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        transition: background 0.2s;
    }
    
    .chat-actions button:hover {
        background: rgba(255,255,255,0.1);
    }
    
    .messages-container {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .message-bubble {
        max-width: 70%;
        padding: 8px 12px;
        border-radius: 18px;
        position: relative;
        word-wrap: break-word;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    .message-bubble.received {
        background: white;
        align-self: flex-start;
        border-bottom-left-radius: 4px;
    }
    
    .message-bubble.sent {
        background: #dcf8c6;
        align-self: flex-end;
        border-bottom-right-radius: 4px;
    }
    
    .message-text {
        margin: 0;
        font-size: 14px;
        line-height: 1.4;
    }
    
    .message-time {
        font-size: 11px;
        color: #666;
        margin-top: 4px;
        text-align: right;
    }
    
    .message-bubble.received .message-time {
        text-align: left;
    }
    
    .message-input-container {
        background: #f0f0f0;
        padding: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .message-input {
        flex: 1;
        padding: 10px 15px;
        border: none;
        border-radius: 25px;
        outline: none;
        font-size: 14px;
        background: white;
    }
    
    .send-button {
        background: #25d366;
        color: white;
        border: none;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .send-button:hover {
        background: #128c7e;
    }
    
    .send-button:disabled {
        background: #ccc;
        cursor: not-allowed;
    }

    /* Activity List */
    .activity-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .activity-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      border-radius: 12px;
      border-left: 4px solid #667eea;
      transition: all 0.3s ease;
    }

    .activity-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
    }

    .activity-item .material-icons {
      color: #667eea;
      font-size: 1.5rem;
    }

    .activity-item .activity-content {
      flex: 1;
    }

    .activity-item .activity-content p {
      margin: 0;
      font-weight: 500;
      color: #333;
    }

    .activity-item .activity-content small {
      color: #666;
      font-size: 0.8rem;
    }

    /* Badge Management */
    .badges-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .badge-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.08);
      border: 1px solid rgba(102, 126, 234, 0.1);
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .badge-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }

    .badge-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 50px rgba(102, 126, 234, 0.15);
    }

    .badge-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      color: white;
      background: linear-gradient(135deg, #667eea, #764ba2);
    }

    .badge-name {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #333;
    }

    .badge-description {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 10px;
    }

    .badge-category {
      font-size: 0.8rem;
      color: #667eea;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Badge Awards List */
    .badge-awards-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .badge-award-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      border-radius: 12px;
      border-left: 4px solid #2dce89;
      transition: all 0.3s ease;
    }

    .badge-award-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 15px rgba(45, 206, 137, 0.1);
    }

    .badge-award-item .member-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #667eea;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .badge-award-item .award-info {
      flex: 1;
    }

    .badge-award-item .award-info h4 {
      margin: 0 0 5px 0;
      font-size: 1rem;
      color: #333;
    }

    .badge-award-item .award-info p {
      margin: 0;
      font-size: 0.9rem;
      color: #666;
    }

    .badge-award-item .award-date {
      font-size: 0.8rem;
      color: #999;
    }

    /* Analytics */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .analytics-item {
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.08);
      border: 1px solid rgba(102, 126, 234, 0.1);
    }

    .analytics-item h3 {
      margin: 0 0 15px 0;
      font-size: 1.1rem;
      color: #333;
      font-weight: 600;
    }

    .analytics-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .analytics-member {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: #f8f9ff;
      border-radius: 8px;
    }

    .analytics-member .member-avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #667eea;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .analytics-member .member-info {
      flex: 1;
    }

    .analytics-member .member-info h4 {
      margin: 0;
      font-size: 0.9rem;
      color: #333;
    }

    .analytics-member .member-info p {
      margin: 0;
      font-size: 0.8rem;
      color: #666;
    }

    .analytics-member .member-score {
      font-size: 0.9rem;
      font-weight: 600;
      color: #667eea;
    }

    /* Message Stats */
    .message-stats {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
    }

    .stat-item {
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
      border-radius: 12px;
      border: 1px solid rgba(102, 126, 234, 0.1);
    }

    .stat-number {
      display: block;
      font-size: 2rem;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #666;
      font-weight: 500;
    }

  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
    <div class="logo-container">
      <img src="logo.png" alt="POP N' PLAN Logo">
      <h2>POP N' PLAN</h2>
    </div>
    <div class="menu">
      <h4>Main Menu</h4>
      <ul>
        <li><a href="#" class="active" data-page="overview"><span class="material-icons">dashboard</span>Overview</a></li>
        <li><a href="#" data-page="events"><span class="material-icons">event</span>Event Management</a></li>
        <li><a href="#" data-page="members"><span class="material-icons">group</span>Committee Members</a></li>
        <li><a href="#" data-page="leaderboard"><span class="material-icons">leaderboard</span>Leaderboard</a></li>
        <li><a href="#" data-page="schedule"><span class="material-icons">calendar_month</span>Schedule</a></li>
      </ul>
      <h4>Management</h4>
      <ul>
        <li><a href="#" data-page="badges"><span class="material-icons">emoji_events</span>Badge Management</a></li>
        <li><a href="#" data-page="analytics"><span class="material-icons">analytics</span>Analytics</a></li>
      </ul>
      <h4>Settings & Others</h4>
      <ul>
        <li><a href="#" data-page="profile"><span class="material-icons">settings</span>Profile Settings</a></li>
        <li><a href="#" data-page="messages"><span class="material-icons">message</span>Messages</a></li>
        <li><a href="#" data-page="spreadsheets"><span class="material-icons">cloud_download</span>Reports</a></li>
        <li><a href="#" data-page="logout"><span class="material-icons">logout</span>Logout</a></li>
      </ul>
    </div>
  </div>

  <!-- Main -->
  <div class="main">
    <!-- Header -->
    <div class="header">
      <div class="search-bar">
        <span class="material-icons">search</span>
        <input type="text" id="globalSearchInput" placeholder="Search events, members..." />
      </div>
      <div id="adminProfile" class="admin-profile">
        <img id="adminAvatar" src="default-avatar.png" alt="Admin Avatar">
        <span id="adminName">Loading...</span>
      </div>
    </div>

    <!-- Overview Page -->
    <div id="overview" class="page active">
      <h1>Admin Dashboard Overview</h1>
      <div class="stats-grid">
        <div class="stat-card total-events">
            <div class="icon"><span class="material-icons">event</span></div>
            <h3>Total Events</h3>
            <p id="totalEvents">0</p>
        </div>
        <div class="stat-card new-members">
            <div class="icon"><span class="material-icons">person_add</span></div>
            <h3>New Members (30d)</h3>
            <p id="newMembersCount">0</p>
        </div>
        <div class="stat-card impressions">
            <div class="icon"><span class="material-icons">visibility</span></div>
            <h3>Event Impressions</h3>
            <p id="totalImpressions">0</p>
        </div>
        <div class="stat-card total-badges">
            <div class="icon"><span class="material-icons">emoji_events</span></div>
            <h3>Badges Awarded</h3>
            <p id="totalBadgesAwarded">0</p>
        </div>
        <div class="stat-card total-messages">
            <div class="icon"><span class="material-icons">message</span></div>
            <h3>Messages Sent</h3>
            <p id="totalMessagesSent">0</p>
        </div>
        <div class="stat-card active-committees">
            <div class="icon"><span class="material-icons">groups</span></div>
            <h3>Active Committees</h3>
            <p id="activeCommittees">4</p>
        </div>
      </div>

      <div class="card">
        <h2>Recent Activity</h2>
        <div id="recentActivityList" class="activity-list">
          <!-- Recent activity will be loaded here -->
        </div>
      </div>

      <div class="card">
        <h2>Upcoming Events</h2>
        <div id="upcomingEventList" class="event-list-grid">
          <!-- Upcoming events will be loaded here -->
        </div>
      </div>

      <div class="card">
        <h2>Latest Committee Members</h2>
        <ul id="latestMembersList" class="member-list">
            <!-- Latest members will be loaded here -->
        </ul>
      </div>
    </div>

    <!-- Event Management Page -->
    <div id="events" class="page">
      <h1>Event Management</h1>
      <div class="card">
        <h2>Add New Event</h2>
        <form id="eventForm">
          <input type="text" id="eventTitle" placeholder="Event Title" required>
          <textarea id="eventDescription" placeholder="Event Description"></textarea>
          <input type="date" id="eventDate" required>
          <div style="display: flex; gap: 10px; align-items: center;">
            <input type="time" id="eventTime" required style="flex: 1;">
            <select id="eventAmPm" required style="flex: 0 0 80px;">
              <option value="AM">AM</option>
              <option value="PM">PM</option>
            </select>
          </div>
          <input type="text" id="eventVenue" placeholder="Venue (e.g., College Auditorium)" required>
          <input type="text" id="eventImage" placeholder="Image URL (optional)">
          <button type="submit" class="btn-primary"><span class="material-icons">add</span> Add Event</button>
        </form>
      </div>
      <div class="card">
        <h2>All Events</h2>
        <div id="allEventList" class="event-list-grid">
          <!-- All events will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Committee Members Page -->
    <div id="members" class="page">
        <h1>Committee Members</h1>
        <div class="card">
            <h2>Add New Member</h2>
            <form id="memberForm">
                <input type="text" id="memberName" placeholder="Member Name" required>
                <input type="email" id="memberEmail" placeholder="Member Email" required>
                <input type="text" id="memberRole" placeholder="Role (e.g., Organizer, Volunteer)">
                <input type="text" id="memberAvatar" placeholder="Avatar URL (optional)">
                <button type="submit" class="btn-primary"><span class="material-icons">person_add</span> Add Member</button>
            </form>
        </div>
        <div class="card">
            <h2>Current Members</h2>
            <ul id="committeeMembersList" class="member-list">
                <!-- Committee members will be loaded here -->
            </ul>
        </div>
    </div>

    <!-- Leaderboard Page -->
    <div id="leaderboard" class="page">
      <h1>Leaderboard</h1>
      <div class="card">
        <h2>Top Performers</h2>
        <ul id="leaderboardList" class="member-list">
            <!-- Leaderboard items will be loaded here -->
        </ul>
      </div>
    </div>

    <!-- Schedule Page -->
    <div id="schedule" class="page">
      <h1>Event Schedule</h1>
      <div class="card">
        <div id="calendar"></div>
      </div>
    </div>

    <!-- Profile Settings Page -->
    <div id="profile" class="page">
      <h1>Profile Settings</h1>
      <div class="card">
        <form id="profileForm">
          <label>Nickname:</label>
          <input type="text" id="nickname">
          <label>Contact Email:</label>
          <input type="email" id="contact">
          <label>Profile Picture URL:</label>
          <input type="text" id="avatarUrl">
          <button type="submit" class="btn-primary"><span class="material-icons">save</span> Update Profile</button>
        </form>
      </div>
    </div>

    <!-- Messages Page -->
    <div id="messages" class="page">
      <h1>Messages & Announcements</h1>
      <div class="card">
        <div class="whatsapp-container">
          <!-- Contacts Sidebar -->
          <div class="contacts-sidebar">
            <div class="contacts-header">
              <span class="material-icons">chat</span>
              <h3>Messages</h3>
              <button onclick="broadcastMessage()" style="background: none; border: none; color: white; cursor: pointer; margin-left: auto;" title="Broadcast to all members">
                <span class="material-icons">campaign</span>
              </button>
            </div>
            <div class="contacts-search">
              <input type="text" id="contactSearch" placeholder="Search contacts...">
            </div>
            <div class="contacts-list" id="contactsList">
              <!-- Contacts will be loaded here -->
            </div>
          </div>
          
          <!-- Chat Area -->
          <div class="chat-area">
            <div class="chat-header" id="chatHeader" style="display: none;">
              <div class="chat-avatar" id="chatAvatar">A</div>
              <div class="chat-info">
                <div class="chat-name" id="chatName">Select a contact</div>
                <div class="chat-status" id="chatStatus">Choose someone to start chatting</div>
              </div>
              <div class="chat-actions">
                <button onclick="refreshMessages()"><span class="material-icons">refresh</span></button>
                <button onclick="clearChat()"><span class="material-icons">clear</span></button>
              </div>
            </div>
            
            <div class="messages-container" id="messagesContainer">
              <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; text-align: center;">
                <div>
                  <span class="material-icons" style="font-size: 48px; margin-bottom: 10px; display: block;">chat_bubble_outline</span>
                  <p>Select a contact to start messaging</p>
                </div>
              </div>
            </div>
            
            <div class="message-input-container" id="messageInputContainer" style="display: none;">
              <input type="text" id="messageInput" class="message-input" placeholder="Type a message...">
              <button id="sendMessageButton" class="send-button">
                <span class="material-icons">send</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Reports Page (formerly Spreadsheets) -->
    <div id="spreadsheets" class="page">
      <h1>Reports & Analytics</h1>
      <div class="card">
        <h2>Event Registrations</h2>
        <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
          <button onclick="loadRegistrations().then(() => renderRegistrationsTable())" class="btn-primary" style="background:#5e72e4;"><span class="material-icons">refresh</span> Refresh Data</button>
          <span id="registrationCount" style="color: #666; font-weight: 600;"></span>
        </div>
        <div id="registrationsTable" style="overflow-x: auto; margin: 20px 0; border: 1px solid #ddd; border-radius: 8px;">
          <table style="width: 100%; border-collapse: collapse; background: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 13px;">
            <thead style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; position: sticky; top: 0; z-index: 10;">
              <tr>
                <th style="padding: 12px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; white-space: nowrap;">Event Name</th>
                <th style="padding: 12px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; white-space: nowrap;">Registrant Name</th>
                <th style="padding: 12px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; white-space: nowrap;">Email</th>
                <th style="padding: 12px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; white-space: nowrap;">Phone</th>
                <th style="padding: 12px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; white-space: nowrap;">Class</th>
                <th style="padding: 12px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; white-space: nowrap;">Roll No</th>
                <th style="padding: 12px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; white-space: nowrap;">PRN</th>
                <th style="padding: 12px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; white-space: nowrap;">Registration Date</th>
                <th style="padding: 12px 8px; text-align: left; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; white-space: nowrap;">Status</th>
                <th style="padding: 12px 8px; text-align: left; font-weight: 600; white-space: nowrap;">Actions</th>
              </tr>
            </thead>
            <tbody id="registrationsTableBody">
              <!-- Registrations will be loaded here -->
            </tbody>
          </table>
        </div>
        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
        <button onclick="exportEventsToExcel()" class="btn-primary"><span class="material-icons">download</span> Export Events to Excel</button>
          <button onclick="exportRegistrationsToExcel()" class="btn-primary" style="background:#2dce89;"><span class="material-icons">download</span> Export Registrations to Excel</button>
          <button onclick="exportMembersToExcel()" class="btn-primary" style="background:#ff6b6b;"><span class="material-icons">download</span> Export Members to Excel</button>
          <button onclick="printRegistrations()" class="btn-primary" style="background:#17a2b8;"><span class="material-icons">print</span> Print Report</button>
        </div>
      </div>
    </div>

    <!-- Badge Management Page -->
    <div id="badges" class="page">
      <h1>Badge Management</h1>
      <div class="card">
        <h2>Award Badge to Member</h2>
        <form id="badgeAwardForm">
          <select id="memberSelect" required>
            <option value="">Select Member</option>
          </select>
          <select id="badgeSelect" required>
            <option value="">Select Badge</option>
          </select>
          <textarea id="badgeReason" placeholder="Reason for awarding this badge..." rows="3"></textarea>
          <button type="submit" class="btn-primary">
            <span class="material-icons">emoji_events</span> Award Badge
          </button>
        </form>
      </div>
      
      <div class="card">
        <h2>Available Badges</h2>
        <div id="availableBadgesGrid" class="badges-grid">
          <!-- Available badges will be loaded here -->
        </div>
      </div>
      
      <div class="card">
        <h2>Recent Badge Awards</h2>
        <div id="recentBadgeAwards" class="badge-awards-list">
          <!-- Recent badge awards will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Analytics Page -->
    <div id="analytics" class="page">
      <h1>Analytics & Insights</h1>
      <div class="card">
        <h2>Member Engagement</h2>
        <div class="analytics-grid">
          <div class="analytics-item">
            <h3>Most Active Members</h3>
            <div id="mostActiveMembers" class="analytics-content">
              <!-- Most active members will be loaded here -->
            </div>
          </div>
          <div class="analytics-item">
            <h3>Popular Events</h3>
            <div id="popularEvents" class="analytics-content">
              <!-- Popular events will be loaded here -->
            </div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <h2>Message Statistics</h2>
        <div class="message-stats">
          <div class="stat-item">
            <span class="stat-number" id="totalMessages">0</span>
            <span class="stat-label">Total Messages</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="avgResponseTime">0</span>
            <span class="stat-label">Avg Response Time (min)</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="activeConversations">0</span>
            <span class="stat-label">Active Conversations</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Logout Page (Placeholder) -->
    <div id="logout" class="page">
      <h1>Logging Out...</h1>
      <div class="card">
        <p>You will be securely logged out. Redirecting to login page...</p>
      </div>
    </div>

  </div>

<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales-all.min.js"></script>
<script>
  // --- API Configuration ---
  const API_BASE_URL = '/api/events';
  let events = [];
  let registrations = [];

  // Initialize empty arrays for real-time data
  let mockMembers = [];
  let mockLeaderboard = [];
  let mockMessages = [];

  let currentUserProfile = {
    nickname: 'Admin',
    contact: 'admin@popnplan.com',
    avatarUrl: 'https://i.pravatar.cc/150?img=8',
    committee: 'Central Committee'
  };

  // Simulate API token and login check
  const token = localStorage.getItem('token');
  if (!token) {
    // In a real app, this would redirect to a login page
    // For this demo, we'll assume a valid token for the current user
    localStorage.setItem('token', 'mock-admin-token');
  }

  // --- DOM Elements ---
  const adminNameEl = document.getElementById('adminName');
  const adminAvatarEl = document.getElementById('adminAvatar');
  const globalSearchInput = document.getElementById('globalSearchInput');

  // Overview Page Elements
  const totalEventsEl = document.getElementById('totalEvents');
  const newMembersCountEl = document.getElementById('newMembersCount');
  const totalImpressionsEl = document.getElementById('totalImpressions');
  const upcomingEventList = document.getElementById('upcomingEventList');
  const latestMembersList = document.getElementById('latestMembersList');

  // Event Management Page Elements
  const eventForm = document.getElementById('eventForm');
  const eventTitleInput = document.getElementById('eventTitle');
  const eventDescriptionInput = document.getElementById('eventDescription');
  const eventDateInput = document.getElementById('eventDate');
  const eventTimeInput = document.getElementById('eventTime');
  const eventAmPmInput = document.getElementById('eventAmPm');
  const eventVenueInput = document.getElementById('eventVenue');
  const eventImageInput = document.getElementById('eventImage');
  const allEventList = document.getElementById('allEventList');

  // Committee Members Page Elements
  const memberForm = document.getElementById('memberForm');
  const memberNameInput = document.getElementById('memberName');
  const memberEmailInput = document.getElementById('memberEmail');
  const memberRoleInput = document.getElementById('memberRole');
  const memberAvatarInput = document.getElementById('memberAvatar');
  const committeeMembersList = document.getElementById('committeeMembersList');

  // Leaderboard Page Elements
  const leaderboardList = document.getElementById('leaderboardList');

  // Profile Settings Page Elements
  const profileForm = document.getElementById('profileForm');
  const nicknameInput = document.getElementById('nickname');
  const contactInput = document.getElementById('contact');
  const avatarUrlInput = document.getElementById('avatarUrl');

  // Messages Page Elements
  const contactsList = document.getElementById('contactsList');
  const contactSearch = document.getElementById('contactSearch');
  const chatHeader = document.getElementById('chatHeader');
  const chatAvatar = document.getElementById('chatAvatar');
  const chatName = document.getElementById('chatName');
  const chatStatus = document.getElementById('chatStatus');
  const messagesContainer = document.getElementById('messagesContainer');
  const messageInputContainer = document.getElementById('messageInputContainer');
  const messageInput = document.getElementById('messageInput');
  const sendMessageButton = document.getElementById('sendMessageButton');
  
  // Message state
  let currentConversationId = null;
  let conversations = [];
  let members = [];

  // --- FullCalendar Instance ---
  let calendar; // Will be initialized when schedule page is active

  // --- Utility Functions ---

  // Generate a simple unique ID
  function generateId() {
    return '_' + Math.random().toString(36).substr(2, 9);
  }

  // Helper to format date/time
  function formatDateTime(isoString) {
      const date = new Date(isoString);
      return date.toLocaleString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
  }

  // --- Data Loading Functions ---

  // Simulate fetching current user profile
  async function loadAdminProfile() {
    // In a real app: fetch("/api/auth/me", { headers: { "x-auth-token": token } })
    // For mock:
    return new Promise(resolve => {
      setTimeout(() => {
        adminNameEl.textContent = `Hi, ${currentUserProfile.nickname || currentUserProfile.committee}`;
        adminAvatarEl.src = currentUserProfile.avatarUrl;
        nicknameInput.value = currentUserProfile.nickname;
        contactInput.value = currentUserProfile.contact;
        avatarUrlInput.value = currentUserProfile.avatarUrl;
        resolve(currentUserProfile);
      }, 100);
    });
  }

  // Render a single event card
  function renderEventCard(ev) {
      return `
      <div class="event-card">
        <img src="${ev.image || 'https://via.placeholder.com/400x180?text=Event+Image'}" alt="${ev.title}">
        <h4>${ev.title}</h4>
        <p><span class="material-icons" style="font-size:16px;vertical-align:middle;">calendar_today</span> ${new Date(ev.date).toLocaleDateString()}</p>
        <p><span class="material-icons" style="font-size:16px;vertical-align:middle;">access_time</span> ${ev.time}</p>
        <p><span class="material-icons" style="font-size:16px;vertical-align:middle;">location_on</span> ${ev.venue || 'TBD'}</p>
        <small>${ev.description ? ev.description.substring(0, 100) + (ev.description.length > 100 ? '...' : '') : 'No description provided.'}</small>
        <div class="event-actions">
            <button class="edit-event" data-id="${ev._id}"><span class="material-icons">edit</span> Edit</button>
            <button class="delete-event" data-id="${ev._id}"><span class="material-icons">delete</span> Delete</button>
        </div>
      </div>`;
  }

  // Load and render events for Overview & Event Management
  async function loadEvents(filter = '') {
    try {
      const response = await fetch(API_BASE_URL);
      if (!response.ok) {
        if (response.status === 0 || !response.ok) {
          throw new Error('Server is not running. Please start the server first.');
        }
        throw new Error('Failed to fetch events');
      }
      
      events = await response.json();
      
        const now = new Date();
        const thirtyDaysLater = new Date();
        thirtyDaysLater.setDate(now.getDate() + 30);

      const filteredEvents = events.filter(ev =>
            ev.title.toLowerCase().includes(filter.toLowerCase()) ||
            ev.description.toLowerCase().includes(filter.toLowerCase())
        );

        // Update total events count
        totalEventsEl.textContent = filteredEvents.length;

        // Filter for upcoming events (within the next 30 days)
        const upcoming = filteredEvents.filter(ev => {
            const eventDateTime = new Date(`${ev.date}T${ev.time}`);
            return eventDateTime > now && eventDateTime <= thirtyDaysLater;
        }).sort((a, b) => new Date(`${a.date}T${a.time}`) - new Date(`${b.date}T${b.time}`));

        upcomingEventList.innerHTML = upcoming.length > 0
            ? upcoming.map(renderEventCard).join('')
            : `
              <div style="text-align: center; padding: 40px; color: var(--ios-gray-6);">
                <span class="material-icons" style="font-size: 48px; margin-bottom: 16px; display: block;">event_available</span>
                <p>No upcoming events</p>
                <p style="font-size: var(--font-size-sm); margin-top: 8px;">Create your first event to get started</p>
              </div>
            `;

        allEventList.innerHTML = filteredEvents.length > 0
            ? filteredEvents.map(renderEventCard).join('')
            : `
              <div style="text-align: center; padding: 40px; color: var(--ios-gray-6);">
                <span class="material-icons" style="font-size: 48px; margin-bottom: 16px; display: block;">event_note</span>
                <p>No events added yet</p>
                <p style="font-size: var(--font-size-sm); margin-top: 8px;">Add your first event to begin</p>
              </div>
            `;

        attachEventCardListeners(); // Attach listeners after rendering
      return filteredEvents;
    } catch (error) {
      console.error('Error loading events:', error);
      const errorMessage = error.message.includes('Server is not running') 
        ? '<p style="color: #e74c3c; padding: 20px; text-align: center; background: #fdf2f2; border: 1px solid #fecaca; border-radius: 8px; margin: 10px 0;"><strong> Server Not Running</strong><br>Please start the server by running: <code>node server.js</code> in the terminal</p>'
        : '<p>Error loading events. Please check your connection.</p>';
      
      upcomingEventList.innerHTML = errorMessage;
      allEventList.innerHTML = errorMessage;
      return [];
    }
  }

  // Attach event listeners to edit/delete buttons on event cards
  function attachEventCardListeners() {
      document.querySelectorAll('.edit-event').forEach(button => {
          button.onclick = (e) => {
              const eventId = e.currentTarget.dataset.id;
              // In a real app, you'd fetch the event data and populate a modal/form
              alert(`Editing event with ID: ${eventId}`);
          };
      });
      document.querySelectorAll('.delete-event').forEach(button => {
          button.onclick = async (e) => {
              const eventId = e.currentTarget.dataset.id;
              if (confirm(`Are you sure you want to delete this event?`)) {
                  try {
                      const response = await fetch(`${API_BASE_URL}/${eventId}`, {
                          method: 'DELETE'
                      });
                      
                      if (!response.ok) {
                          const errorData = await response.json();
                          throw new Error(errorData.error || 'Failed to delete event');
                      }
                      
                      alert('Event deleted successfully!');
                  loadEvents(globalSearchInput.value); // Reload events
                  updateCalendar(); // Update calendar as well
                  } catch (error) {
                      console.error('Error deleting event:', error);
                      alert('Error deleting event: ' + error.message);
                  }
              }
          };
      });
  }


  // Render a single member list item
  function renderMemberListItem(member) {
      return `
      <li>
        <img src="${member.avatarUrl || 'https://via.placeholder.com/40x40?text=M'}" alt="${member.name}">
        <span>${member.name} - ${member.role}</span>
        <small>Joined: ${new Date(member.createdAt).toLocaleDateString()}</small>
        <div class="member-actions">
            <button class="edit-member" data-id="${member.id}"><span class="material-icons">edit</span> Edit</button>
            <button class="delete-member" data-id="${member.id}" class="delete"><span class="material-icons">delete</span> Delete</button>
        </div>
      </li>`;
  }

  // Load and render committee members
  async function loadCommitteeMembers(filter = '') {
    // In a real app: fetch('/api/admin/members', { headers: { 'x-auth-token': token } })
    // For mock:
    return new Promise(resolve => {
      setTimeout(() => {
        const now = new Date();
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(now.getDate() - 30);

        const filteredMembers = mockMembers.filter(member =>
            member.name.toLowerCase().includes(filter.toLowerCase()) ||
            member.email.toLowerCase().includes(filter.toLowerCase()) ||
            member.role.toLowerCase().includes(filter.toLowerCase())
        );

        // Update new members count (joined in last 30 days)
        newMembersCountEl.textContent = filteredMembers.filter(m => {
            const joinedDate = new Date(m.createdAt);
            return joinedDate > thirtyDaysAgo;
        }).length;

        // Sort members by join date (newest first)
        const sortedMembers = [...filteredMembers].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
        const latestFiveMembers = sortedMembers.slice(0, 5); // Top 5 for overview

        committeeMembersList.innerHTML = filteredMembers.length > 0
            ? filteredMembers.map(renderMemberListItem).join('')
            : `
              <div style="text-align: center; padding: 40px; color: var(--ios-gray-6);">
                <span class="material-icons" style="font-size: 48px; margin-bottom: 16px; display: block;">group_add</span>
                <p>No members found</p>
                <p style="font-size: var(--font-size-sm); margin-top: 8px;">Add your first member to get started</p>
              </div>
            `;

        latestMembersList.innerHTML = latestFiveMembers.length > 0
            ? latestFiveMembers.map(member => `
                <li>
                  <img src="${member.avatarUrl || 'https://via.placeholder.com/40x40?text=M'}" alt="${member.name}">
                  <span>${member.name}</span>
                  <small>Joined: ${new Date(member.createdAt).toLocaleDateString()}</small>
                </li>`).join('')
            : `
              <div style="text-align: center; padding: 20px; color: var(--ios-gray-6);">
                <span class="material-icons" style="font-size: 32px; margin-bottom: 8px; display: block;">group_add</span>
                <p>No members yet</p>
              </div>
            `;

        attachMemberListItemListeners(); // Attach listeners after rendering
        resolve(filteredMembers);
      }, 100);
    });
  }

  // Attach event listeners to edit/delete buttons on member list items
  function attachMemberListItemListeners() {
      document.querySelectorAll('.edit-member').forEach(button => {
          button.onclick = (e) => {
              const memberId = e.currentTarget.dataset.id;
              // In a real app, you'd fetch the member data and populate a modal/form
              alert(`Editing member with ID: ${memberId}`);
          };
      });
      document.querySelectorAll('.delete-member').forEach(button => {
          button.onclick = (e) => {
              const memberId = e.currentTarget.dataset.id;
              if (confirm(`Are you sure you want to delete member ${memberId}?`)) {
                  // Simulate deletion
                  mockMembers = mockMembers.filter(m => m.id !== memberId);
                  alert('Member deleted!');
                  loadCommitteeMembers(globalSearchInput.value); // Reload members
                  loadLeaderboard(); // Leaderboard might change
              }
          };
      });
  }


  // Load and render leaderboard
  async function loadLeaderboard() {
    // In a real app: fetch('/api/admin/leaderboard', { headers: { 'x-auth-token': token } })
    // For mock:
    return new Promise(resolve => {
      setTimeout(() => {
        // Ensure leaderboard reflects current members
        const currentMemberIds = new Set(mockMembers.map(m => m.id));
        const filteredLeaderboard = mockLeaderboard.filter(lb => currentMemberIds.has(lb.id));

        // Sort by points (descending)
        filteredLeaderboard.sort((a, b) => b.points - a.points);

        leaderboardList.innerHTML = filteredLeaderboard.length > 0
            ? filteredLeaderboard.map((u, i) => `<li>
                <img src="${u.avatarUrl || 'https://via.placeholder.com/40x40?text=A'}" alt="${u.name}">
                <span>${i+1}. ${u.name}</span>
                <small>${u.points || 0} pts</small>
            </li>`).join('')
            : `
              <div style="text-align: center; padding: 40px; color: var(--ios-gray-6);">
                <span class="material-icons" style="font-size: 48px; margin-bottom: 16px; display: block;">emoji_events</span>
                <p>No leaderboard data</p>
                <p style="font-size: var(--font-size-sm); margin-top: 8px;">Add members to start tracking performance</p>
              </div>
            `;
        resolve(filteredLeaderboard);
      }, 100);
    });
  }

  // Load members for messaging
  async function loadMembers() {
    try {
      const response = await fetch('/api/member');
      if (response.ok) {
        members = await response.json();
      } else {
        // Fallback to empty array for real-time data
        members = [];
      }
      renderContacts();
    } catch (error) {
      console.error('Error loading members:', error);
      members = [];
      renderContacts();
    }
  }

  // Load conversations
  async function loadConversations() {
    try {
      const response = await fetch('/api/messages/conversations');
      if (response.ok) {
        conversations = await response.json();
        renderContacts();
      }
    } catch (error) {
      console.error('Error loading conversations:', error);
    }
  }

  // Render contacts list
  function renderContacts() {
    if (!contactsList) return;
    
    const searchTerm = contactSearch ? contactSearch.value.toLowerCase() : '';
    const filteredMembers = members.filter(member => 
      member.name.toLowerCase().includes(searchTerm) ||
      member.email.toLowerCase().includes(searchTerm)
    );

    if (filteredMembers.length === 0) {
      contactsList.innerHTML = `
        <div style="text-align: center; padding: 40px; color: var(--ios-gray-6);">
          <span class="material-icons" style="font-size: 48px; margin-bottom: 16px; display: block;">person_add</span>
          <p>No contacts found</p>
          <p style="font-size: var(--font-size-sm); margin-top: 8px;">Add members to start messaging</p>
        </div>
      `;
      return;
    }

    contactsList.innerHTML = filteredMembers.map(member => {
      const conversation = conversations.find(conv => conv._id === member.id);
      const unreadCount = conversation ? conversation.unreadCount : 0;
      const lastMessage = conversation ? conversation.lastMessage : null;
      
      return `
        <div class="contact-item" onclick="selectContact('${member.id}', '${member.name}', '${member.role}')">
          <div class="contact-avatar">${member.name.charAt(0).toUpperCase()}</div>
          <div class="contact-info">
            <div class="contact-name">${member.name}</div>
            <div class="contact-role">${member.role}</div>
            ${lastMessage ? `<div style="font-size: 11px; color: #666; margin-top: 2px;">${lastMessage.content.substring(0, 30)}${lastMessage.content.length > 30 ? '...' : ''}</div>` : ''}
          </div>
          ${unreadCount > 0 ? `<div class="contact-status">${unreadCount}</div>` : ''}
        </div>
      `;
    }).join('');
  }

  // Select contact and load conversation
  async function selectContact(memberId, memberName, memberRole) {
    currentConversationId = memberId;
    
    // Update chat header
    chatName.textContent = memberName;
    chatStatus.textContent = `${memberRole}  Online`;
    chatAvatar.textContent = memberName.charAt(0).toUpperCase();
    
    // Show chat interface
    chatHeader.style.display = 'flex';
    messageInputContainer.style.display = 'flex';
    
    // Load messages
    await loadMessages(memberId);
    
    // Mark messages as read
    await markMessagesAsRead(memberId);
    
    // Update contact selection
    document.querySelectorAll('.contact-item').forEach(item => {
      item.classList.remove('active');
    });
    event.currentTarget.classList.add('active');
  }

  // Load messages for a conversation
  async function loadMessages(memberId) {
    try {
      const response = await fetch(`/api/messages/conversation/${memberId}`);
      if (response.ok) {
        const messages = await response.json();
        renderMessages(messages);
      } else {
        // Show empty state
        messagesContainer.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; text-align: center;">
            <div>
              <span class="material-icons" style="font-size: 48px; margin-bottom: 10px; display: block;">chat_bubble_outline</span>
              <p>No messages yet. Start the conversation!</p>
            </div>
          </div>
        `;
      }
    } catch (error) {
      console.error('Error loading messages:', error);
      showMessageFeedback('Failed to load messages', 'error');
    }
  }

  // Render messages
  function renderMessages(messages) {
    if (messages.length === 0) {
      messagesContainer.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; text-align: center;">
          <div>
            <span class="material-icons" style="font-size: 48px; margin-bottom: 10px; display: block;">chat_bubble_outline</span>
            <p>No messages yet. Start the conversation!</p>
          </div>
        </div>
      `;
      return;
    }

    messagesContainer.innerHTML = messages.map(msg => `
      <div class="message-bubble ${msg.senderId === 'admin' ? 'sent' : 'received'}">
        <div class="message-text">${msg.content}</div>
        <div class="message-time">${new Date(msg.createdAt).toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit' 
        })}</div>
                </div>
            `).join('');

    // Scroll to bottom
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  }

  // Send message
  async function sendMessage() {
    const content = messageInput.value.trim();
    if (!content || !currentConversationId) return;

    // Show loading state
    const sendBtn = document.getElementById('sendMessageButton');
    const originalContent = sendBtn.innerHTML;
    sendBtn.innerHTML = '<span class="material-icons" style="animation: spin 1s linear infinite;">refresh</span>';
    sendBtn.disabled = true;

    try {
      const response = await fetch('/api/messages/send', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          receiverId: currentConversationId,
          content: content,
          messageType: 'text'
        })
      });

      if (response.ok) {
        messageInput.value = '';
        // Update message statistics
        updateMessageStats();
        // Reload messages
        await loadMessages(currentConversationId);
        // Reload conversations to update last message
        await loadConversations();
        
        // Show success feedback
        showMessageFeedback('Message sent successfully!', 'success');
      } else {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Failed to send message');
      }
    } catch (error) {
      console.error('Error sending message:', error);
      showMessageFeedback('Failed to send message: ' + error.message, 'error');
    } finally {
      // Reset button state
      sendBtn.innerHTML = originalContent;
      sendBtn.disabled = false;
    }
  }

  // Mark messages as read
  async function markMessagesAsRead(memberId) {
    try {
      await fetch(`/api/messages/read/${memberId}`, {
        method: 'PUT'
      });
    } catch (error) {
      console.error('Error marking messages as read:', error);
    }
  }

  // Broadcast message to all members
  async function broadcastMessage() {
    const content = prompt('Enter broadcast message:');
    if (!content) return;

    // Show loading state
    const broadcastBtn = document.querySelector('[onclick="broadcastMessage()"]');
    const originalContent = broadcastBtn.innerHTML;
    broadcastBtn.innerHTML = '<span class="material-icons" style="animation: spin 1s linear infinite;">refresh</span>';
    broadcastBtn.disabled = true;

    try {
      const response = await fetch('/api/messages/broadcast', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          content: content,
          messageType: 'announcement'
        })
      });

      if (response.ok) {
        const result = await response.json();
        showMessageFeedback(`Broadcast sent to ${result.sentTo} members successfully!`, 'success');
        await loadConversations();
        updateMessageStats();
      } else {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Failed to send broadcast');
      }
    } catch (error) {
      console.error('Error broadcasting message:', error);
      showMessageFeedback('Failed to send broadcast: ' + error.message, 'error');
    } finally {
      // Reset button state
      broadcastBtn.innerHTML = originalContent;
      broadcastBtn.disabled = false;
    }
  }

  // Show message feedback
  function showMessageFeedback(message, type) {
    // Create feedback element
    const feedback = document.createElement('div');
    feedback.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 10000;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      max-width: 300px;
      word-wrap: break-word;
    `;
    
    if (type === 'success') {
      feedback.style.background = 'linear-gradient(135deg, #2dce89, #24a46d)';
    } else {
      feedback.style.background = 'linear-gradient(135deg, #f5365c, #e21c3d)';
    }
    
    feedback.textContent = message;
    document.body.appendChild(feedback);
    
    // Animate in
    setTimeout(() => {
      feedback.style.transform = 'translateX(0)';
    }, 100);
    
    // Remove after 3 seconds
    setTimeout(() => {
      feedback.style.transform = 'translateX(100%)';
      setTimeout(() => {
        document.body.removeChild(feedback);
      }, 300);
    }, 3000);
  }

  // Refresh messages
  function refreshMessages() {
    if (currentConversationId) {
      loadMessages(currentConversationId);
    }
  }

  // Clear chat
  function clearChat() {
    if (confirm('Are you sure you want to clear this chat?')) {
      messagesContainer.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666; text-align: center;">
          <div>
            <span class="material-icons" style="font-size: 48px; margin-bottom: 10px; display: block;">chat_bubble_outline</span>
            <p>Chat cleared</p>
          </div>
        </div>
      `;
    }
  }

  // Load registrations for reports
  async function loadRegistrations() {
    try {
      const response = await fetch(`${API_BASE_URL}/admin/all-registrations`);
      if (!response.ok) throw new Error('Failed to fetch registrations');
      
      registrations = await response.json();
      return registrations;
    } catch (error) {
      console.error('Error loading registrations:', error);
      return [];
    }
  }

  // Render registrations table
  function renderRegistrationsTable() {
    const tbody = document.getElementById('registrationsTableBody');
    const countEl = document.getElementById('registrationCount');
    
    if (!tbody) return;

    if (registrations.length === 0) {
      tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 40px; color: #666; font-style: italic;">No registrations found</td></tr>';
      if (countEl) countEl.textContent = 'Total Registrations: 0';
      return;
    }

    // Update count
    if (countEl) countEl.textContent = `Total Registrations: ${registrations.length}`;

    tbody.innerHTML = registrations.map((reg, index) => `
      <tr style="border-bottom: 1px solid #e9ecef; transition: background-color 0.2s; ${index % 2 === 0 ? 'background-color: #f8f9fa;' : 'background-color: white;'}">
        <td style="padding: 10px 8px; border-right: 1px solid #e9ecef; font-weight: 600; color: #495057;">${reg.eventTitle}</td>
        <td style="padding: 10px 8px; border-right: 1px solid #e9ecef; color: #212529;">${reg.registrantName}</td>
        <td style="padding: 10px 8px; border-right: 1px solid #e9ecef; color: #007bff; text-decoration: underline;">${reg.registrantEmail}</td>
        <td style="padding: 10px 8px; border-right: 1px solid #e9ecef; color: #495057;">${reg.registrantPhone}</td>
        <td style="padding: 10px 8px; border-right: 1px solid #e9ecef; color: #495057;">${reg.registrantClass}</td>
        <td style="padding: 10px 8px; border-right: 1px solid #e9ecef; color: #495057; font-weight: 600;">${reg.registrantRollNo}</td>
        <td style="padding: 10px 8px; border-right: 1px solid #e9ecef; color: #495057; font-weight: 600;">${reg.registrantPRN}</td>
        <td style="padding: 10px 8px; border-right: 1px solid #e9ecef; color: #6c757d; font-size: 12px;">${new Date(reg.registrationDate).toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'short', 
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        })}</td>
        <td style="padding: 10px 8px; border-right: 1px solid #e9ecef;">
          <span style="padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
            background: ${reg.status === 'approved' ? '#d4edda' : reg.status === 'rejected' ? '#f8d7da' : '#fff3cd'};
            color: ${reg.status === 'approved' ? '#155724' : reg.status === 'rejected' ? '#721c24' : '#856404'};
            border: 1px solid ${reg.status === 'approved' ? '#c3e6cb' : reg.status === 'rejected' ? '#f5c6cb' : '#ffeaa7'};">
            ${reg.status}
          </span>
        </td>
        <td style="padding: 10px 8px;">
          <button onclick="updateRegistrationStatus('${reg._id}', 'approved')" style="background: #28a745; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; margin-right: 4px; cursor: pointer;">Approve</button>
          <button onclick="updateRegistrationStatus('${reg._id}', 'rejected')" style="background: #dc3545; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 11px; cursor: pointer;">Reject</button>
        </td>
      </tr>
    `).join('');

    // Add hover effect
    tbody.querySelectorAll('tr').forEach(row => {
      row.addEventListener('mouseenter', () => {
        row.style.backgroundColor = '#e3f2fd';
      });
      row.addEventListener('mouseleave', () => {
        const index = Array.from(tbody.children).indexOf(row);
        row.style.backgroundColor = index % 2 === 0 ? '#f8f9fa' : 'white';
      });
    });
  }

  // Simulate total impressions
  async function loadTotalImpressions() {
      // In a real app, this would fetch from an analytics service
      // For now, show 0 for real-time data
      totalImpressionsEl.textContent = '0';
  }

  // --- Event Handlers ---

  // Sidebar navigation
  const links = document.querySelectorAll('.menu a');
  const pages = document.querySelectorAll('.page');
  links.forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const targetPageId = link.getAttribute('data-page');

      if (targetPageId === 'logout') {
          localStorage.removeItem('token');
          alert("You have been logged out!");
          // In a real app: window.location.href = "login.html";
          return;
      }

      // Remove active class from all links and pages
      links.forEach(l => l.classList.remove('active'));
      pages.forEach(p => p.classList.remove('active'));
      
      // Add active class to clicked link
      link.classList.add('active');
      
      // Show the target page
      const targetPage = document.getElementById(targetPageId);
      if (targetPage) {
        targetPage.classList.add('active');
      }

      // Load data and setup for the newly active page
      switch (targetPageId) {
          case 'overview':
              loadEvents(globalSearchInput.value);
              loadCommitteeMembers(''); // No filter for latest members section
              loadTotalImpressions();
              break;
          case 'events':
              loadEvents(globalSearchInput.value);
              break;
          case 'members':
              loadCommitteeMembers(globalSearchInput.value);
              break;
          case 'leaderboard':
              loadLeaderboard();
              break;
          case 'schedule':
              initializeCalendar();
              break;
          case 'profile':
              loadAdminProfile(); // Reload profile details for form
              break;
          case 'messages':
              loadMembers();
              loadConversations();
              break;
          case 'spreadsheets':
              loadRegistrations().then(() => renderRegistrationsTable());
              break;
          case 'badges':
              loadAvailableBadges();
              populateMemberSelect();
              renderRecentBadgeAwards();
              break;
          case 'analytics':
              loadAnalytics();
              break;
      }
    });
  });

  // Event Form Submission
  if (eventForm) {
    eventForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        // Combine time and AM/PM
        const timeValue = eventTimeInput.value;
        const amPmValue = eventAmPmInput.value;
        const formattedTime = timeValue + ' ' + amPmValue;
        
        const newEvent = {
          title: eventTitleInput.value,
          description: eventDescriptionInput.value,
          date: eventDateInput.value,
          time: formattedTime,
          venue: eventVenueInput.value,
          image: eventImageInput.value,
          createdBy: 'admin' // In production, get from JWT token
        };

        const response = await fetch(API_BASE_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(newEvent)
        });

        if (!response.ok) {
          if (response.status === 0) {
            throw new Error('Server is not running. Please start the server first.');
          }
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to create event');
        }

        const result = await response.json();
        eventForm.reset();
        alert("Event added successfully!");
        loadEvents(globalSearchInput.value); // Reload for overview and events page
        updateCalendar(); // Update calendar
      } catch (error) {
        console.error('Error creating event:', error);
        if (error.message.includes('Server is not running')) {
          alert(' Server Not Running!\n\nPlease start the server by running:\nnode server.js\n\nin your terminal first.');
        } else {
          alert('Error creating event: ' + error.message);
        }
      }
    });
  }

  // Member Form Submission
  if (memberForm) {
    memberForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const newMember = {
        id: generateId(),
        name: memberNameInput.value,
        email: memberEmailInput.value,
        role: memberRoleInput.value,
        avatarUrl: memberAvatarInput.value,
        createdAt: new Date().toISOString()
      };
      // In a real app: fetch('/api/admin/member', { method: 'POST', body: JSON.stringify(newMember) ... })
      // For mock:
      mockMembers.push(newMember);
      // Also add to leaderboard with default points
      mockLeaderboard.push({ id: newMember.id, name: newMember.name, points: 100, avatarUrl: newMember.avatarUrl });
      memberForm.reset();
      alert("Member added successfully!");
      loadCommitteeMembers(globalSearchInput.value); // Reload for members page and overview
      loadLeaderboard(); // Update leaderboard
    });
  }

  // Profile Form Submission
  if (profileForm) {
    profileForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      currentUserProfile.nickname = nicknameInput.value;
      currentUserProfile.contact = contactInput.value;
      currentUserProfile.avatarUrl = avatarUrlInput.value;
      // In a real app: fetch('/api/admin/profile', { method: 'PUT', body: JSON.stringify(currentUserProfile) ... })
      // For mock:
      alert("Profile updated!");
      loadAdminProfile(); // Refresh header and form
    });
  }

  // Message Sending
  if (sendMessageButton) {
      sendMessageButton.addEventListener('click', () => {
          const content = messageInput.value.trim();
          if (content) {
              const newMessage = {
                  id: generateId(),
                  sender: currentUserProfile.nickname || 'You', // Assuming admin sends messages
                  content: content,
                  timestamp: new Date().toISOString(),
                  isSent: true
              };
              mockMessages.push(newMessage);
              messageInput.value = '';
              loadMessages(); // Refresh message list
          }
      });
      messageInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
              sendMessageButton.click();
          }
      });
  }
  if (contactSearch) {
      contactSearch.addEventListener('input', renderContacts);
  }

  // Badge Award Form Submission
  const badgeAwardForm = document.getElementById('badgeAwardForm');
  if (badgeAwardForm) {
    badgeAwardForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const memberId = document.getElementById('memberSelect').value;
      const badgeId = document.getElementById('badgeSelect').value;
      const reason = document.getElementById('badgeReason').value;

      if (!memberId || !badgeId) {
        alert('Please select both a member and a badge');
        return;
      }

      const success = await awardBadgeToMember(memberId, badgeId, reason);
      if (success) {
        badgeAwardForm.reset();
      }
    });
  }

  // --- Search Functionality ---
  globalSearchInput.addEventListener('input', debounce(() => {
    const query = globalSearchInput.value;
    const activePage = document.querySelector('.page.active').id;

    if (activePage === 'events') {
        loadEvents(query);
    } else if (activePage === 'members') {
        loadCommitteeMembers(query);
    } else if (activePage === 'overview') {
        // For overview, apply search to both upcoming events and latest members
        loadEvents(query);
        loadCommitteeMembers(query);
    }
    // You could expand this to search other pages too
  }, 300)); // Debounce to prevent too many re-renders


  // Debounce function
  function debounce(func, delay) {
    let timeout;
    return function(...args) {
      const context = this;
      clearTimeout(timeout);
      timeout = setTimeout(() => func.apply(context, args), delay);
    };
  }

  // --- Calendar Functionality (FullCalendar.js) ---
  function initializeCalendar() {
    const calendarEl = document.getElementById('calendar');
    if (!calendarEl) return;

    if (calendar) { // If calendar already exists, destroy it before re-initializing
        calendar.destroy();
    }

    calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
      },
      events: events.map(event => ({
          id: event._id,
          title: event.title,
          start: `${event.date}T${event.time}`,
          description: event.description,
          // You can add more properties like color based on event type
          backgroundColor: '#5e72e4', // A nice blue for events
          borderColor: '#5e72e4'
      })),
      eventDidMount: function(info) {
        // Add a tooltip or custom styling on mount if needed
      },
      eventClick: function(info) {
        alert(`Event: ${info.event.title}\nDate: ${new Date(info.event.start).toLocaleString()}\nDescription: ${info.event.extendedProps.description || 'No description'}`);
      }
    });
    calendar.render();
  }

  function updateCalendar() {
      if (calendar) {
          calendar.setOption('events', events.map(event => ({
              id: event._id,
              title: event.title,
              start: `${event.date}T${event.time}`,
              description: event.description,
              backgroundColor: '#5e72e4',
              borderColor: '#5e72e4'
          })));
      }
  }


  // --- Export to Excel Functionality ---
  function convertToCSV(arr) {
    const array = [Object.keys(arr[0])].concat(arr);
    return array.map(it => {
      return Object.values(it).toString();
    }).join('\n');
  }

  function downloadCSV(csv, filename) {
    const csvFile = new Blob([csv], { type: "text/csv" });
    const downloadLink = document.createElement("a");
    downloadLink.download = filename;
    downloadLink.href = window.URL.createObjectURL(csvFile);
    downloadLink.style.display = "none";
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
  }

  function exportEventsToExcel() {
    if (events.length === 0) {
        alert("No events to export!");
        return;
    }
    const eventsToExport = events.map(event => ({
        ID: event._id,
        Title: event.title,
        Description: event.description,
        Date: new Date(event.date).toLocaleDateString(),
        Time: event.time,
        Venue: event.venue || 'TBD',
        MaxParticipants: event.maxParticipants,
        ImageUrl: event.image
    }));
    const csv = convertToCSV(eventsToExport);
    downloadCSV(csv, "popnplan_events.csv");
  }

  function exportMembersToExcel() {
    if (mockMembers.length === 0) {
        alert("No members to export!");
        return;
    }
    const membersToExport = mockMembers.map(member => ({
        ID: member.id,
        Name: member.name,
        Email: member.email,
        Role: member.role,
        JoinedDate: new Date(member.createdAt).toLocaleDateString(),
        AvatarUrl: member.avatarUrl
    }));
    const csv = convertToCSV(membersToExport);
    downloadCSV(csv, "popnplan_members.csv");
  }

  function exportRegistrationsToExcel() {
    if (registrations.length === 0) {
        alert("No registrations to export!");
        return;
    }
    const registrationsToExport = registrations.map(reg => ({
        EventName: reg.eventTitle,
        RegistrantName: reg.registrantName,
        Email: reg.registrantEmail,
        Phone: reg.registrantPhone,
        Class: reg.registrantClass,
        RollNo: reg.registrantRollNo,
        PRN: reg.registrantPRN,
        RegistrationDate: new Date(reg.registrationDate).toLocaleDateString(),
        Status: reg.status
    }));
    const csv = convertToCSV(registrationsToExport);
    downloadCSV(csv, "popnplan_registrations.csv");
  }

  // Update registration status
  async function updateRegistrationStatus(registrationId, status) {
    try {
      const response = await fetch(`${API_BASE_URL}/registrations/${registrationId}/status`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ status: status })
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'Failed to update status');
      }

      alert(`Registration ${status} successfully!`);
      // Reload registrations
      await loadRegistrations();
      renderRegistrationsTable();
    } catch (error) {
      console.error('Error updating registration status:', error);
      alert('Error updating status: ' + error.message);
    }
  }

  // Print registrations
  function printRegistrations() {
    const printWindow = window.open('', '_blank');
    const table = document.getElementById('registrationsTable').innerHTML;
    
    printWindow.document.write(`
      <html>
        <head>
          <title>Event Registrations Report</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
            th { background-color: #f2f2f2; font-weight: bold; }
            .no-data { text-align: center; padding: 40px; color: #666; }
            @media print { body { margin: 0; } }
          </style>
        </head>
        <body>
          <h1>Event Registrations Report</h1>
          <p>Generated on: ${new Date().toLocaleString()}</p>
          <p>Total Registrations: ${registrations.length}</p>
          ${table}
        </body>
      </html>
    `);
    
    printWindow.document.close();
    printWindow.print();
  }


  // --- Badge Management Functions ---
  let availableBadges = [];
  let recentBadgeAwards = [];

  // Load available badges
  async function loadAvailableBadges() {
    try {
      const response = await fetch('/api/badges');
      if (response.ok) {
        availableBadges = await response.json();
        renderAvailableBadges();
        populateBadgeSelect();
      }
    } catch (error) {
      console.error('Error loading badges:', error);
    }
  }

  // Render available badges
  function renderAvailableBadges() {
    const container = document.getElementById('availableBadgesGrid');
    if (!container) return;

    container.innerHTML = availableBadges.map(badge => `
      <div class="badge-card">
        <div class="badge-icon">
          <span class="material-icons">${badge.icon}</span>
        </div>
        <div class="badge-name">${badge.name}</div>
        <div class="badge-description">${badge.description}</div>
        <div class="badge-category">${badge.category}</div>
      </div>
    `).join('');
  }

  // Populate badge select dropdown
  function populateBadgeSelect() {
    const badgeSelect = document.getElementById('badgeSelect');
    if (!badgeSelect) return;

    badgeSelect.innerHTML = '<option value="">Select Badge</option>' +
      availableBadges.map(badge => 
        `<option value="${badge.id}">${badge.name}</option>`
      ).join('');
  }

  // Populate member select dropdown
  function populateMemberSelect() {
    const memberSelect = document.getElementById('memberSelect');
    if (!memberSelect) return;

    memberSelect.innerHTML = '<option value="">Select Member</option>' +
      mockMembers.map(member => 
        `<option value="${member.id}">${member.name} (${member.role})</option>`
      ).join('');
  }

  // Award badge to member
  async function awardBadgeToMember(memberId, badgeId, reason) {
    try {
      const response = await fetch('/api/admin/award-badge', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          userId: memberId,
          badgeId: badgeId,
          reason: reason
        })
      });

      if (response.ok) {
        const result = await response.json();
        
        // Add to recent awards
        const member = mockMembers.find(m => m.id === memberId);
        const badge = availableBadges.find(b => b.id === badgeId);
        
        recentBadgeAwards.unshift({
          id: generateId(),
          memberName: member.name,
          memberRole: member.role,
          badgeName: badge.name,
          reason: reason,
          awardedAt: new Date().toISOString()
        });

        // Keep only last 10 awards
        if (recentBadgeAwards.length > 10) {
          recentBadgeAwards = recentBadgeAwards.slice(0, 10);
        }

        renderRecentBadgeAwards();
        updateBadgeStats();
        
        alert(`Badge "${badge.name}" awarded to ${member.name} successfully!`);
        return true;
      } else {
        throw new Error('Failed to award badge');
      }
    } catch (error) {
      console.error('Error awarding badge:', error);
      alert('Error awarding badge: ' + error.message);
      return false;
    }
  }

  // Render recent badge awards
  function renderRecentBadgeAwards() {
    const container = document.getElementById('recentBadgeAwards');
    if (!container) return;

    if (recentBadgeAwards.length === 0) {
      container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">No recent badge awards</p>';
      return;
    }

    container.innerHTML = recentBadgeAwards.map(award => `
      <div class="badge-award-item">
        <div class="member-avatar">${award.memberName.charAt(0).toUpperCase()}</div>
        <div class="award-info">
          <h4>${award.memberName} - ${award.badgeName}</h4>
          <p>${award.reason || 'No reason provided'}</p>
        </div>
        <div class="award-date">${new Date(award.awardedAt).toLocaleDateString()}</div>
      </div>
    `).join('');
  }

  // Update badge statistics
  function updateBadgeStats() {
    const totalBadgesEl = document.getElementById('totalBadgesAwarded');
    if (totalBadgesEl) {
      totalBadgesEl.textContent = recentBadgeAwards.length;
    }
  }

  // Load recent activity
  function loadRecentActivity() {
    const container = document.getElementById('recentActivityList');
    if (!container) return;

    const activities = [
      {
        icon: 'event',
        content: 'New event "Tech Workshop" created',
        time: '2 hours ago'
      },
      {
        icon: 'person_add',
        content: 'New member John Doe joined',
        time: '4 hours ago'
      },
      {
        icon: 'emoji_events',
        content: 'Badge "First Event" awarded to Jane Smith',
        time: '6 hours ago'
      },
      {
        icon: 'message',
        content: 'Message sent to 15 members',
        time: '1 day ago'
      }
    ];

    container.innerHTML = activities.map(activity => `
      <div class="activity-item">
        <span class="material-icons">${activity.icon}</span>
        <div class="activity-content">
          <p>${activity.content}</p>
          <small>${activity.time}</small>
        </div>
      </div>
    `).join('');
  }

  // Load analytics data
  function loadAnalytics() {
    loadMostActiveMembers();
    loadPopularEvents();
    loadMessageStats();
  }

  // Load most active members
  function loadMostActiveMembers() {
    const container = document.getElementById('mostActiveMembers');
    if (!container) return;

    const activeMembers = mockLeaderboard.slice(0, 5);
    
    container.innerHTML = activeMembers.map(member => `
      <div class="analytics-member">
        <div class="member-avatar">${member.name.charAt(0).toUpperCase()}</div>
        <div class="member-info">
          <h4>${member.name}</h4>
          <p>Committee Member</p>
        </div>
        <div class="member-score">${member.points} pts</div>
      </div>
    `).join('');
  }

  // Load popular events
  function loadPopularEvents() {
    const container = document.getElementById('popularEvents');
    if (!container) return;

    const popularEvents = events.slice(0, 3);
    
    container.innerHTML = popularEvents.map(event => `
      <div class="analytics-member">
        <div class="member-avatar"></div>
        <div class="member-info">
          <h4>${event.title}</h4>
          <p>${event.venue || 'TBD'}</p>
        </div>
        <div class="member-score">${Math.floor(Math.random() * 50) + 10} reg</div>
      </div>
    `).join('');
  }

  // Load message statistics
  function loadMessageStats() {
    const totalMessagesEl = document.getElementById('totalMessages');
    const avgResponseTimeEl = document.getElementById('avgResponseTime');
    const activeConversationsEl = document.getElementById('activeConversations');

    // Show 0 for empty counts instead of random numbers
    if (totalMessagesEl) totalMessagesEl.textContent = '0';
    if (avgResponseTimeEl) avgResponseTimeEl.textContent = '0';
    if (activeConversationsEl) activeConversationsEl.textContent = '0';
  }

  // Update message statistics
  function updateMessageStats() {
    const totalMessagesEl = document.getElementById('totalMessagesSent');
    if (totalMessagesEl) {
      const currentCount = parseInt(totalMessagesEl.textContent) || 0;
      totalMessagesEl.textContent = currentCount + 1;
    }
  }

  // --- Initial Page Load ---
  // Load necessary data when the dashboard loads
  document.addEventListener('DOMContentLoaded', () => {
    loadAdminProfile();
    loadEvents(globalSearchInput.value); // Load initial events for overview
    loadCommitteeMembers(''); // Load initial members for overview
    loadTotalImpressions();
    loadRecentActivity();
    loadAvailableBadges();
    populateMemberSelect();
    updateBadgeStats();
    // No need to initialize calendar here, it's done when 'schedule' page is clicked.
  });
</script>
  </div>
</body>
</html>